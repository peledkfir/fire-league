angular.module("siyfion.sfTypeahead",[]).directive("sfTypeahead",function(){return{restrict:"ACE",scope:{datasets:"=",ngModel:"="},link:function(a,b){function c(c,e,f){var g=b.val();a.$apply(function(){d=!0,a.ngModel=e,a.selectedDataset=f}),b.val(g)}var d=!1;b.typeahead(a.datasets),b.bind("typeahead:selected",function(b,d,e){c(b,d,e),a.$emit("typeahead:selected")}),b.bind("typeahead:autocompleted",function(b,d,e){c(b,d,e),a.$emit("typeahead:autocompleted")}),b.bind("input",function(){a.$apply(function(){d=!0;var c=b.val();a.ngModel=c})}),a.$watch("ngModel",function(c){var e;if(d)return d=!1,void 0;if($.isArray(a.datasets)){for(var f=0;f<a.datasets.length;f++)if(a.datasets[f].name==a.selectedDataset){e=a.datasets[f].valueKey;break}}else e=a.datasets.valueKey;c&&e&&c.hasOwnProperty(e)&&(c=c[e]),b.typeahead("setQuery",c||"")})}}});